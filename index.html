<!DOCTYPE html>
<html lang="en" translate="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate">
    <link rel="stylesheet" href="styles.css">
    <title>Simplos</title>
    
    <!-- Fonts and Styles -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2.39.7"></script>
    <script src="vocabs.js"></script>

    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icons/icon-512x512.png">

</head>
<body>


    <div class="vertical-nav-container">
        <button class="hamburger-button">
          <i class="fas fa-bars"></i>
        </button>
        <button class="nav-button home-button">
          <i class="fas fa-home"></i>
        </button>
        <button class="nav-button fullscreen-button">
          <i class="fas fa-expand"></i>
        </button>
        <button class="nav-button reset-button">
          <i class="fas fa-trash-alt"></i>
        </button>
        <button class="nav-button settings-button">
          <i class="fas fa-cog"></i>
        </button>
        <button class="nav-button accessibility-button">
          <i class="fas fa-universal-access"></i>
        </button>
      </div>


  <div id="welcome-screen" class="screen visible">
    <div class="particle-container" id="particleContainer"></div>    
    <h1 class="welcome-title">Simplos</h1>
    
<!-- Add right after the welcome-title -->
<div class="ad-container">
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-9563715706895348"
         data-ad-slot="1234567890"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    <script>
       (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>

    <div class="main-buttons">
        <button class="main-button primary" onclick="showAuthModal()">Login / Sign Up</button>
        <button class="main-button guest-play-button" onclick="startGame()">Play as Guest</button>
        <button class="main-button arcade-button" onclick="showArcadeModal()">Arcade</button>
        <button class="main-button" onclick="showCustomListsManager()">My Lists</button>
        <button class="main-button stages-button" onclick="showStageCascadeScreen()">Stages</button>
        <button class="main-button download-app-button" disabled="disabled">Download the App</button>
    </div>

    <!-- New Auth Modal -->
    <div id="authModal" class="auth-modal">
        <div class="auth-modal-content">
            <div id="loginForm" class="auth-form">
                <h2>Login</h2>
                <input type="text" class="auth-input" placeholder="Username or Email" id="loginUsername">                <input type="password" class="auth-input" placeholder="Password" id="loginPassword">
                <button class="auth-button" onclick="handleLogin()">Login</button>
                <button class="auth-toggle" onclick="toggleAuthMode()">New? Register here</button>
            </div>
            <div id="signupForm" class="auth-form hidden">
                <h2>Sign Up</h2>
                <input type="email" class="auth-input" placeholder="Email" id="signupEmail">
                <input type="text" class="auth-input" placeholder="Username" id="signupUsername">
                <input type="password" class="auth-input" placeholder="Password" id="signupPassword">
                <button class="auth-button" onclick="handleSignup()">Sign Up</button>
                <button class="auth-toggle" onclick="toggleAuthMode()">Already have an account?</button>
            </div>
        </div>
    </div>

   <div class="side-panel">
    <div class="side-panel-content">
        <button class="logout-button logout-top-button">
    <i class="fas fa-sign-out-alt"></i> Logout
</button>        
        <div class="welcome-buttons">
            <a href="#" class="nav-link" onclick="showScreen('stage-screen'); return false;">
    <i class="fas fa-map-marked-alt"></i> Level Map
</a>
            <a href="#" class="nav-link" onclick="showCustomListsManager(); return false;">
                <i class="fas fa-list"></i> My Lists
            </a>
            <a href="#" class="nav-link" onclick="showLeaderboard(); return false;">
                <i class="fas fa-trophy"></i> Speedboard
            </a>
            <a href="#" class="nav-link" onclick="showPricesScreen(); return false;">
                <i class="fas fa-dollar-sign"></i> Prices
            </a>
            <a href="https://simplos.netlify.app/about.html" target="_blank" class="nav-link"><i class="fas fa-info-circle"></i> About </a>
            <a href="mailto:danav.bred@gmail.com?subject=About%20Simplos" class="nav-link">
                <i class="fas fa-envelope"></i> Contact Us
            </a>
        </div>
        
        <div class="user-profile-section user-profile-bottom">
            <div class="username-display" id="userEmail"></div>
            <div class="status-badge" id="userTierText"></div>
            
            <div class="user-stats">
                <div class="stat-item">
                    <div class="stat-label">Words</div>
                    <div class="stat-value" id="totalWords">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Coins</div>
                    <div class="stat-value">
                        <i class="fas fa-coins coin-icon"></i>
                        <span id="totalCoins">0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>

<div id="stage-cascade-screen" class="screen">
    <div class="particle-container"></div>
    </div>
    <div class="stages-container">
<!-- Add after the stages-container div -->
<div class="ad-container">
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-9563715706895348"
         data-ad-slot="1234567891"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    <script>
       (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>

        <!-- Stages will be populated dynamically here -->
    </div>
</div>

<!-- REPLACE level-screen div -->
<div id="level-screen" class="screen">
    <div class="particle-container"></div>
    
    <div class="level-container" id="level-container"></div>
</div>

<div id="question-screen" class="screen">
    <div class="particle-container"></div>
    
    <!-- Question Word -->
    <div class="question-word" id="question-word"></div>

    <!-- Progress Circle with Timer and Coins -->
    <div class="progress-circle">
        <svg width="100%" height="100%" viewBox="0 0 120 120">
            <circle class="bg" cx="60" cy="60" r="54" stroke-width="8"/>
            <circle class="progress" cx="60" cy="60" r="54" stroke-width="8"/>
            <circle class="timer-bg" cx="60" cy="60" r="40" stroke-width="4"/>
            <circle class="timer-progress" cx="60" cy="60" r="40" stroke-width="4"/>
        </svg>
        <div class="coins-container">
            <i class="fas fa-coins coin-icon"></i>
            <span class="coin-count">0</span>
        </div>
    </div>

    <!-- Perks Container -->
    <div class="perks-container">
        <button class="perk-button" id="timeFreezePerk">
            <i class="fas fa-clock perk-icon"></i>
            <span class="perk-count">0</span>
        </button>
        <button class="perk-button" id="skipPerk">
            <i class="fas fa-forward perk-icon"></i>
            <span class="perk-count">0</span>
        </button>
        <button class="perk-button" id="cluePerk">
            <i class="fas fa-lightbulb perk-icon"></i>
            <span class="perk-count">0</span>
        </button>
        <button class="perk-button" id="revealPerk">
            <i class="fas fa-eye perk-icon"></i>
            <span class="perk-count">0</span>
        </button>
    </div>


    
    <!-- Replace the old powerups-container content with this -->
    <div class="powerups-container">
    <!-- Goodies -->
    <div class="powerup-card goodie" id="highFiveCard">
        <i class="fas fa-hand-paper powerup-icon"></i>
        <div class="powerup-name">High Five</div>
        <div class="powerup-cost">30</div>
    </div>
    <div class="powerup-card goodie" id="fistBumpCard">
        <i class="fas fa-fist-raised powerup-icon"></i>
        <div class="powerup-name">Fist Bump</div>
        <div class="powerup-cost">40</div>
    </div>
    <div class="powerup-card goodie" id="energyBoostCard">
        <i class="fas fa-bolt powerup-icon"></i>
        <div class="powerup-name">Energy Boost</div>
        <div class="powerup-cost">45</div>
    </div>

    <!-- Baddies -->
    <div class="powerup-card baddie" id="freezeCard">
        <i class="fas fa-snowflake powerup-icon"></i>
        <div class="powerup-name">Freeze</div>
        <div class="powerup-cost">150</div>
    </div>
    <div class="powerup-card baddie" id="coinStormCard">
        <i class="fas fa-cloud-showers-heavy powerup-icon"></i>
        <div class="powerup-name">Coin Storm</div>
        <div class="powerup-cost">160</div>
    </div>
    <div class="powerup-card baddie" id="screenShakeCard">
        <i class="fas fa-shake powerup-icon"></i>
        <div class="powerup-name">Screen Shake</div>
        <div class="powerup-cost">130</div>
    </div>
</div>

    <!-- Timer Container -->
    <div class="timer-container">
        <div class="timer-value">00:00</div>
    </div>

    <!-- Answer Buttons -->
    <div class="buttons" id="buttons"></div>
</div>

<!-- Failure Overlay -->
<div class="failure-overlay" style="display: none;">
    <div class="failure-content">
        <h2 class="failure-title">Time's Up!</h2>
        <div class="failure-buttons">
            <button class="restart-button">
                <i class="fas fa-redo"></i>
            </button>
            <button class="home-button">
                <i class="fas fa-home"></i>
            </button>
        </div>
    </div>
</div>

<div id="custom-practice-screen" class="screen">
    

    <div class="custom-practice-container">
        <div class="lists-section">
            <h2 class="welcome-title">Manage</h2>
            <div id="custom-lists-container" class="custom-lists-container">
                <!-- Lists will be dynamically populated here -->
            </div>
        </div>
    
        <div class="practice-section">
            <h2 class="welcome-title">Create</h2>
            <div class="list-name-section">
                <input 
                    type="text" 
                    id="custom-list-name" 
                    class="list-name-input" 
                    placeholder="List Name"
                >
            </div>
            <textarea 
                id="custom-word-input" 
                placeholder="Enter words, separated by commas or newlines"
            ></textarea>
            <div class="word-input-actions">
                <button 
                    onclick="processCustomWords()" 
                    class="main-button"
                >
                    <i class="fas fa-magic"></i> Make
                </button>
                <button 
                    onclick="saveCurrentList()" 
                    class="main-button"
                >
                    <i class="fas fa-save"></i> Save
                </button>
                <button 
                    onclick="addNewWord()" 
                    class="main-button"
                >
                    <i class="fas fa-plus"></i> Add Word
                </button>
            </div>
<div class="translation-results" id="translation-results">
    <div class="word-translation-list" id="word-translation-list">
        <!-- Processed words will appear here -->
    </div>
</div>
            </div>
        </div>
    </div>
</div>


<div id="upgrade-screen" class="screen">
    <div class="fullscreen-upgrade-page">
      <div class="upgrade-header">
        <button class="skip-upgrade-button" onclick="skipUpgrade()">
          Skip
        </button>
      </div>
      
      <div class="upgrade-content">
        <h2 class="upgrade-title">Upgrade to Premium!</h2>
        
        <p class="upgrade-description">
          Get full access to all stages, unlimited custom lists, and many more premium features
        </p>
        
        <div class="features-list">
          <div class="feature-item">
            <i class="fas fa-check-circle"></i>
            <span>Access all 5 stages with hundreds of words</span>
          </div>
          <div class="feature-item">
            <i class="fas fa-check-circle"></i>
            <span>Create unlimited custom word lists</span>
          </div>
          <div class="feature-item">
            <i class="fas fa-check-circle"></i>
            <span>Share your lists with friends</span>
          </div>
        </div>
        
        <div class="upgrade-form-container">
          <form id="upgradeForm" onsubmit="handleUpgradeSubmit(event)">
            <div class="form-group">
              <label>
                <input type="checkbox" id="isAdult" onchange="toggleParentFields()" name="isAdult"> 
                I am over 18 years old
              </label>
            </div>
            
            <div id="parentInfoSection">
              <div class="form-group">
                <label>Parent's Full Name</label>
                <input type="text" id="parentName" name="parentName">
              </div>
              <div class="form-group">
                <label>Parent's Phone Number</label>
                <input type="tel" id="parentPhone" name="parentPhone" pattern="[0-9]{10}" placeholder="Enter parent's phone number">
              </div>
            </div>
            
            <div id="adultInfoSection" style="display: none;">
              <div class="form-group">
                <label>Full Name</label>
                <input type="text" id="fullName" name="fullName">
              </div>
              <div class="form-group">
                <label>Phone Number</label>
                <input type="tel" id="phone" name="phone" pattern="[0-9]{10}" placeholder="Enter your phone number">
              </div>
            </div>
            
            <div class="form-group">
              <label>How did you hear about us?</label>
              <select id="referralSource" name="referralSource">
                <option value="friend">Friend</option>
                <option value="teacher">Teacher</option>
                <option value="social">Social Media</option>
                <option value="other">Other</option>
              </select>
            </div>
            
            <button type="submit" class="upgrade-now-button" onclick="handleUpgradeButtonClick(event)">
                Upgrade Now
              </button>
          </form>
          
          <p class="upgrade-note">After submitting, we'll contact you via WhatsApp</p>
        </div>
      </div>
    </div>
  </div>

  <div id="leaderboard-screen" class="screen">
    <h1 class="welcome-title">Speedboard</h1>
    <div class="leaderboard-container">
        <div class="leaderboard-header">
            <div>Rank</div>
            <div>Player</div>
            <div>Levels</div>
            <div>Words</div>
        </div>
        <div id="leaderboard-entries"></div>
    </div>
</div>

<div id="arcade-modal" class="modal">
   <div class="modal-content">
       <div id="teacher-view" style="display: none;">
        <h2 style="display: none;">Your OTP: <span id="otp"></span></h2>
        <p style="display: none;">Players: <span id="player-count">0</span></p>
           
           <div class="stage-selector">
               <h3>Select Word Pools:</h3>
               <div class="stage-checkboxes">
                   <label>
                       <input type="checkbox" value="1"> Stage 1
                   </label>
                   <label>
                       <input type="checkbox" value="2"> Stage 2
                   </label>
                   <label>
                       <input type="checkbox" value="3"> Stage 3
                   </label>
                   <label>
                       <input type="checkbox" value="4"> Stage 4
                   </label>
                   <label>
                       <input type="checkbox" value="5"> Stage 5
                   </label>
               </div>
               <p class="stage-warning" style="display: none; color: var(--error);">Please select at least one stage</p>
           </div>

           <div class="word-goal">
            <h3>Word Goal: <span id="wordGoalDisplay">50</span> words</h3>
            <div class="slider-container">
                <input type="range" min="1" max="200" value="50" class="word-goal-slider" id="wordGoalSlider">
                <div class="slider-stops">
                    <span class="slider-stop" data-value="0">0</span>
                    <span class="slider-stop" data-value="50">50</span>
                    <span class="slider-stop" data-value="100">100</span>
                    <span class="slider-stop" data-value="150">150</span>
                    <span class="slider-stop" data-value="200">200</span>
                </div>
            </div>
            <input type="number" id="wordGoalInput" min="1" max="200" value="50" class="word-goal-input">
        </div>

        <button class="main-button" onclick="startArcade()">Start</button>
           </div>

       <div id="player-view" style="display: none;">
        <h2>Join Arcade</h2>
    <div class="input-group">
        <input 
            type="text" 
            id="arcadeUsername" 
            placeholder="Choose your username"
            maxlength="15"
        >
        <input 
            type="text" 
            id="otpInput" 
            placeholder="Enter 4-digit Game Code"
            maxlength="4" 
            pattern="[0-9]{4}"
            inputmode="numeric"
        >
    </div>
    <button class="join-button" onclick="joinArcadeWithUsername()">Join Game</button>
</div>
   </div>
</div>

<div id="waiting-screen" class="screen">
    <div class="waiting-container">
        <div class="spinner-container">
            <div class="spinner"></div>
        </div>
        <h2 class="waiting-title">Waiting for Game to Start...</h2>
        <div id="waiting-game-container" style="display: none; position: relative; width: 100%; max-width: 400px; height: 500px; margin: 1.5rem auto; overflow: hidden; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.2);">
            <div id="waiting-game-score" style="position: absolute; top: 10px; right: 10px; color: var(--gold); font-size: 1.2rem; z-index: 10;">Score: 0</div>
            <div id="waiting-game-lives" style="position: absolute; top: 40px; right: 10px; color: var(--gold); font-size: 1.2rem; z-index: 10;">❤️❤️❤️</div>
            <div id="waiting-game-instructions" style="position: absolute; top: 10px; left: 10px; color: #fff; font-size: 0.9rem; opacity: 0.8; z-index: 10; max-width: 60%;">
                Catch matching translations, avoid wrong ones!
            </div>
            <div id="waiting-game-player" style="position: absolute; bottom: 20px; width: 120px; height: 40px; background: var(--accent); border-radius: 20px; color: #fff; text-align: center; line-height: 40px; user-select: none; transform: translateX(-50%); left: 50%; cursor: grab;">חתול</div>
        </div>
        <div class="floating-particles"></div>
    </div>
</div>

<div id="moderator-screen" class="screen">
    <div class="moderator-container">
        <div class="session-info-panel">
            <div class="session-details">
    <h2>Arcade Session</h2>
    <div class="otp-display" id="moderatorOtp"></div>
    <div class="qr-section">
        <canvas id="qrCode"></canvas>
        <p class="qr-hint">Scan to join game</p>
                </div>
                    <div class="session-metadata">
                    <p>Date: <span id="sessionDate"></span></p>
                    <p>Start Time: <span id="sessionStartTime"></span></p>
                    <p>Word Goal: <span id="sessionWordGoal"></span></p>
                    <p>Active Participants: <span id="activeParticipantCount">0</span></p>
                </div>
                <div class="game-controls">
                    <button class="main-button initialize-button" onclick="initializeArcade()">Initialize Arcade</button>

                    <button class="end-arcade-button" onclick="endArcade()">
                        End Arcade
                    </button>
                </div>
            </div>
        </div>
        <div class="leaderboard-panel">
            <div id="arcade-leaderboard" class="moderator-leaderboard">
                <div class="leaderboard-header">
                    <div>Rank</div>
                    <div>Player</div>
                    <div>Words</div>
                    <div>Coins</div>
                    <div>Actions</div>
                </div>
                <!-- Participants will be dynamically populated here -->
            </div>
        </div>
    </div>
</div>

<div id="remove-player-modal" class="modal">
   <div class="modal-content">
       <h3>Remove Player</h3>
       <p>Remove <span id="player-to-remove"></span> from the game?</p>
       <div class="modal-buttons">
           <button class="start-button" onclick="confirmRemovePlayer()">Remove</button>
           <button class="start-button secondary" onclick="closeRemoveModal()">Cancel</button>
       </div>
   </div>
</div>


<div class="accessibility-modal">
    <div class="accessibility-content">
        <div class="accessibility-header">
            <h2>Accessibility Options</h2>
            <button class="close-accessibility" aria-label="Close accessibility menu">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="accessibility-options">
            <!-- Appearance Section -->
            <div class="accessibility-section">
                <h3>Display</h3>
                
                <!-- Contrast Controls -->
                <div class="option-group">
                    <label for="contrast-setting">Contrast</label>
                    <div class="controls">
                        <button class="accessibility-button" data-action="contrast" data-value="normal">Normal</button>
                        <button class="accessibility-button" data-action="contrast" data-value="high">High</button>
                        <button class="accessibility-button" data-action="contrast" data-value="inverted">Inverted</button>
                    </div>
                </div>
                
                <!-- Theme Controls -->
                <div class="option-group">
                    <label>Theme</label>
                    <div class="controls">
                        <button class="accessibility-button" data-action="theme" data-value="default">Default</button>
                        <button class="accessibility-button" data-action="theme" data-value="light">Light</button>
                        <button class="accessibility-button" data-action="theme" data-value="dark">Dark</button>
                    </div>
                </div>
                
                <!-- Saturation Controls -->
                <div class="option-group">
                    <label>Saturation</label>
                    <div class="controls">
                        <button class="accessibility-button" data-action="saturation" data-value="normal">Normal</button>
                        <button class="accessibility-button" data-action="saturation" data-value="grayscale">Grayscale</button>
                    </div>
                </div>
            </div>
            
            <!-- Text Section -->
            <div class="accessibility-section">
                <h3>Text</h3>
                
                <!-- Font Size Controls -->
                <div class="option-group">
                    <label>Font Size</label>
                    <div class="controls">
                        <button class="accessibility-button" data-action="fontSize" data-value="decrease">
                            <i class="fas fa-minus"></i>
                        </button>
                        <button class="accessibility-button" data-action="fontSize" data-value="reset">
                            Reset
                        </button>
                        <button class="accessibility-button" data-action="fontSize" data-value="increase">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Font Type Controls -->
                <div class="option-group">
                    <label>Font Type</label>
                    <div class="controls">
                        <button class="accessibility-button" data-action="fontFamily" data-value="default">Default</button>
                        <button class="accessibility-button" data-action="fontFamily" data-value="dyslexic">Dyslexia Friendly</button>
                    </div>
                </div>
                
                <!-- Letter Spacing Controls -->
                <div class="option-group">
                    <label>Letter Spacing</label>
                    <div class="controls">
                        <button class="accessibility-button" data-action="letterSpacing" data-value="normal">Normal</button>
                        <button class="accessibility-button" data-action="letterSpacing" data-value="increased">Increased</button>
                    </div>
                </div>
            </div>
            
            <!-- Motion and Navigation Section -->
            <div class="accessibility-section">
                <h3>Motion & Navigation</h3>
                
                <!-- Animation Controls -->
                <div class="option-group">
                    <label>Animations</label>
                    <div class="controls">
                        <button class="accessibility-button" data-action="animations" data-value="enabled">Enabled</button>
                        <button class="accessibility-button" data-action="animations" data-value="reduced">Reduced</button>
                        <button class="accessibility-button" data-action="animations" data-value="disabled">Disabled</button>
                    </div>
                </div>
                
                <!-- Focus Indicator Controls -->
                <div class="option-group">
                    <label>Focus Indicator</label>
                    <div class="controls">
                        <button class="accessibility-button" data-action="focus" data-value="normal">Normal</button>
                        <button class="accessibility-button" data-action="focus" data-value="high">Enhanced</button>
                    </div>
                </div>
            </div>
            
            <!-- Interface Section -->
            <div class="accessibility-section">
                <h3>Interface</h3>
                
                <!-- Button Size Controls -->
                <div class="option-group">
                    <label>Button Size</label>
                    <div class="controls">
                        <button class="accessibility-button" data-action="buttonSize" data-value="normal">Normal</button>
                        <button class="accessibility-button" data-action="buttonSize" data-value="large">Large</button>
                    </div>
                </div>
                
                <!-- Cursor Size Controls -->
                <div class="option-group">
                    <label>Cursor Size</label>
                    <div class="controls">
                        <button class="accessibility-button" data-action="cursorSize" data-value="normal">Normal</button>
                        <button class="accessibility-button" data-action="cursorSize" data-value="large">Large</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="accessibility-footer">
            <button class="accessibility-button reset-all" data-action="reset" data-value="all">Reset All Settings</button>
        </div>
    </div>
</div>
<script src="pwa.js"></script>
<script src="script.js"></script>

</body>
</html>