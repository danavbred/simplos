<!DOCTYPE html>
<html lang="en" translate="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate">
    <title>Simplos Wordcraft</title>
    
    <!-- Fonts and Styles -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Core Styles -->
    <link rel="stylesheet" href="styles/shared.css">
    <link rel="stylesheet" href="styles/wordcraft.css">

<!-- REPLACE script loading section in all HTML files -->

<!-- External Dependencies -->
<script src="https://cdn.jsdelivr.net/npm/@nhost/nhost-js@2.2.13/dist/nhost.browser.js"></script>
<script src="vocabs.js"></script>

<!-- Module Scripts -->
<script type="module">
    // Import services
    import { gameService } from './services/nhost.js';
    import { SharedState } from './services/state.js';
    import { 
        showNotification, 
        sanitizeInput, 
        getRandomSimploName,
        showScreen 
    } from './services/utils.js';

    // Initialize game state first
    window.gameState = {
        currentStage: 1,
        currentSet: 1,
        currentLevel: 1,
        coins: 0,
        unlockedSets: {},
        unlockedLevels: {},
        perfectLevels: new Set(),
        completedLevels: new Set(),
        perks: {
            timeFreeze: 0,
            skip: 0,
            clue: 0,
            reveal: 0
        }
    };

    // Make services available globally
    window.gameService = gameService;
    window.sharedState = new SharedState();

    // Initialize async
    async function initializeApp() {
        try {
            await gameService.initialize();
            if (typeof initializeGame === 'function') {
                await initializeGame();
            }
        } catch (error) {
            console.error('Initialization error:', error);
        }
    }

    document.addEventListener('DOMContentLoaded', initializeApp);
</script>

</head>
<body>
    <!-- Navigation -->
    <div class="navigation-container">
        <button class="navigation-button home-button" onclick="returnToMain()">
            <i class="fas fa-home navigation-icon"></i>
        </button>
    </div>

    <!-- Coins Display -->
    <div class="coins-header">
        <i class="fas fa-coins coin-icon"></i>
        <span class="coin-count">0</span>
    </div>

    <!-- Main Content -->
    <div id="wordcraft-screen" class="screen">
        <div class="wordcraft-practice-container">
            <div class="lists-section">
                <h2 class="welcome-title">My Word Lists</h2>
                <div id="wordcraft-lists-container"></div>
            </div>
            
            <div class="practice-section">
                <h2 class="welcome-title">Create Word List</h2>
                <div class="list-name-section">
                    <input type="text" id="wordcraft-list-name" class="list-name-input" placeholder="List Name">
                </div>
                <textarea id="wordcraft-word-input" placeholder="Enter words, separated by commas or newlines"></textarea>
                <div class="word-input-actions">
                    <button onclick="processWords()" class="main-button">Make</button>
                    <button onclick="saveCurrentList()" class="main-button">Save</button>
                    <button onclick="addNewWord()" class="main-button">Add Word</button>
                </div>
                <div class="translation-results" id="translation-results">
                    <div class="word-translation-list" id="word-translation-list"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- System Containers -->
    <div id="modalsContainer"></div>
    <div id="errorContainer" class="error-container"></div>
    <div id="loadingOverlay" class="loading-overlay hidden"></div>

    <div id="notificationContainer" class="notification-container"></div>
    <div id="errorOverlay" class="error-overlay">
        <div class="error-content">
            <h3 class="error-title"></h3>
            <p class="error-message"></p>
            <button class="main-button" onclick="dismissError()">Dismiss</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="vocabs.js"></script>
    <script src="services/nhost.js"></script>
    <script src="services/state.js"></script>
    <script src="services/utils.js"></script>
    <script src="services/wordcraft.js"></script>
</body>
</html>