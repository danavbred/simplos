<!DOCTYPE html>
<html>
<head>
    <title>Auth Debug Test</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2.39.7"></script>
</head>
<body>
    <div>
        <h2>Auth Debug Test</h2>
        <form onsubmit="handleTest(event)">
            <input type="email" id="email" placeholder="Email" required>
            <input type="password" id="password" placeholder="Password" required minlength="6">
            <button type="submit">Test Auth</button>
        </form>
        <div>
            <button onclick="testConnection()">Test Supabase Connection</button>
            <button onclick="checkAuth()">Check Auth Status</button>
        </div>
    </div>

    <pre id="output"></pre>

    <script>
        const SUPABASE_URL = 'https://mczfgzffyyyacisrccqb.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1jemZnemZmeXl5YWNpc3JjY3FiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzgzODYyMDQsImV4cCI6MjA1Mzk2MjIwNH0.rLga_B29Coz1LMeJzFTGLIhckdcojGXnD1ae1bw-QAI';

        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);

        // Test basic Supabase connection
        async function testConnection() {
            const output = document.getElementById('output');
            try {
                const { data, error } = await supabaseClient
                    .from('user_profiles')
                    .select('count(*)', { count: 'exact' })
                    .limit(0);

                if (error) throw error;
                output.innerText = 'Connection test successful!\n' + JSON.stringify(data, null, 2);
            } catch (error) {
                output.innerText = 'Connection test failed:\n' + JSON.stringify(error, null, 2);
            }
        }

        // Check current auth status
        async function checkAuth() {
            const output = document.getElementById('output');
            try {
                const { data: { session }, error } = await supabaseClient.auth.getSession();
                if (error) throw error;
                output.innerText = 'Auth status:\n' + JSON.stringify(session, null, 2);
            } catch (error) {
                output.innerText = 'Auth check failed:\n' + JSON.stringify(error, null, 2);
            }
        }

        async function handleTest(event) {
            event.preventDefault();
            const output = document.getElementById('output');
            output.innerText = 'Testing auth...';

            try {
                const email = document.getElementById('email').value.trim();
                const password = document.getElementById('password').value;

                // Log attempt details (except password)
                console.log('Attempt details:', {
                    email,
                    url: window.location.href,
                    timestamp: new Date().toISOString()
                });

                // Try signup without redirect URL first
                const { data, error } = await supabaseClient.auth.signUp({
                    email,
                    password,
                    options: {
                        data: {
                            timestamp: new Date().toISOString()
                        }
                    }
                });

                if (error) throw error;

                output.innerText = 'Success!\n' + JSON.stringify(data, null, 2);
                
            } catch (error) {
                console.error('Detailed error:', error);
                output.innerText = 'ERROR:\n' + JSON.stringify({
                    message: error.message,
                    status: error.status,
                    name: error.name,
                    details: error.details
                }, null, 2);
            }
        }

        // Log initial setup info
        window.addEventListener('load', () => {
            console.log('Environment info:', {
                url: window.location.href,
                protocol: window.location.protocol,
                host: window.location.host,
                timestamp: new Date().toISOString()
            });
        });
    </script>
</body>
</html>